<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f1628">
  <title>Verbo ‚Äî Vocabulaire</title>
  <link rel="stylesheet" href="shared/style.css">
  <style>
    html, body { height: 100%; height: 100dvh; background: #0f1628; overflow: hidden; }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BROWSE MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    #browse {
      background: linear-gradient(160deg, #0f1628 0%, #1c2d50 100%);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
    }
    .browse-header { padding: 48px 22px 10px; display: flex; align-items: center; gap: 12px; }
    .browse-header h1 { font-size: 1.5rem; font-weight: 900; flex: 1; }
    .mode-bar { padding: 0 22px; }

    .theme-tabs {
      display: flex; gap: 6px; padding: 12px 22px; flex-wrap: wrap;
    }
    .theme-btn {
      padding: 6px 14px; border-radius: 20px; border: 1px solid rgba(255,255,255,.15);
      background: transparent; color: var(--text-muted); font-size: .76rem; font-weight: 600;
      cursor: pointer; transition: all .2s;
    }
    .theme-btn.active { background: #6c3483; color: white; border-color: #6c3483; }

    .vocab-grid { padding: 6px 22px 60px; display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }

    .vocab-card {
      width: 160px; height: 120px; perspective: 800px; cursor: pointer;
    }
    .vc-inner {
      width: 100%; height: 100%; position: relative;
      transition: transform .45s ease; transform-style: preserve-3d;
    }
    .vocab-card.flipped .vc-inner { transform: rotateY(180deg); }
    .vc-front, .vc-back {
      position: absolute; inset: 0; backface-visibility: hidden;
      border-radius: var(--radius-md); padding: 14px;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center;
    }
    .vc-front {
      background: var(--surface); border: 1px solid var(--border);
    }
    .vc-es { font-size: 1.05rem; font-weight: 800; color: var(--gold); }
    .vc-tap { font-size: .6rem; color: var(--text-dim); margin-top: 8px; }
    .vc-back {
      background: var(--bg-card); border: 1px solid var(--border);
      transform: rotateY(180deg);
    }
    .vc-fr { font-size: .9rem; font-weight: 700; color: white; }
    .vc-ex { font-size: .7rem; color: var(--text-muted); margin-top: 6px; font-style: italic; }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    #quiz-home {
      background: linear-gradient(160deg, #0f1628 0%, #1c2d50 100%);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
    }
    .quiz-header { padding: 48px 22px 10px; display: flex; align-items: center; gap: 12px; }
    .quiz-header h1 { font-size: 1.5rem; font-weight: 900; flex: 1; }
    .quiz-lists { padding: 14px 22px 48px; display: flex; flex-direction: column; gap: 9px; }

    .list-card {
      border-radius: var(--radius-md); padding: 14px 16px;
      display: flex; align-items: center; gap: 13px;
      cursor: pointer; transition: transform .12s;
      background: var(--surface); border: 1px solid rgba(255,255,255,.08);
    }
    .list-card:active { transform: scale(.97); }
    .lc-emoji { font-size: 1.7rem; width: 42px; text-align: center; flex-shrink: 0; }
    .lc-body  { flex: 1; min-width: 0; }
    .lc-name  { font-size: .95rem; font-weight: 700; }
    .lc-desc  { font-size: .72rem; color: var(--text-muted); margin-top: 2px; }
    .lc-score { font-size: .72rem; margin-top: 3px; color: rgba(255,255,255,.35); }
    .lc-score b { color: var(--gold); }
    .lc-score .done-badge { color: var(--green); font-weight: 700; }
    .lc-arrow { font-size: 1.3rem; color: var(--text-dim); flex-shrink: 0; }

    #quiz-game {
      background: linear-gradient(160deg, #0f1628 0%, #1c2d50 100%);
    }
    .game-topbar { display: flex; align-items: center; gap: 10px; padding: 50px 18px 10px; flex-shrink: 0; }
    .g-back { width: 36px; height: 36px; border-radius: 50%; background: var(--surface); border: none; color: white;
      font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .g-counter { font-size: .82rem; font-weight: 700; color: var(--gold); white-space: nowrap; flex-shrink: 0; }

    .card-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 28px; min-height: 0; }
    #game-card { text-align: center; transition: transform .3s ease, opacity .3s ease; }
    .big-word { font-size: clamp(2rem, 9vw, 3.5rem); font-weight: 900; letter-spacing: -1px; line-height: 1; color: var(--gold); }
    .hint-row { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 18px; min-height: 32px; }

    .input-zone { padding: 0 20px 36px; flex-shrink: 0; }
    .input-row  { display: flex; gap: 9px; align-items: stretch; }

    #quiz-wrong {
      background: rgba(5,8,18,.92); align-items: center; justify-content: center;
      text-align: center; padding: 40px 30px; z-index: 100;
    }
    .wr-icon { font-size: 3.5rem; }
    .wr-title { font-size: 2.2rem; font-weight: 900; color: #e74c3c; margin-top: 8px; }
    .wr-verb { font-size: 1rem; color: rgba(255,255,255,.5); margin-top: 10px; }
    .wr-box { margin-top: 18px; padding: 14px 28px; border-radius: var(--radius-md); background: rgba(255,255,255,.06); border: 1px solid var(--border); }
    .wr-box-lbl { font-size: .72rem; color: rgba(255,255,255,.35); margin-bottom: 4px; }
    .wr-answer { font-size: 1.25rem; font-weight: 800; color: var(--gold); }
    .wr-ex { font-size: .85rem; color: rgba(255,255,255,.5); margin-top: 12px; font-style: italic; }
    .wr-count { margin-top: 28px; font-size: .83rem; color: rgba(255,255,255,.35); }
    .wr-count b { color: rgba(255,255,255,.6); }
    .wr-tap { margin-top: 10px; font-size: .75rem; color: var(--text-dim); }

    #quiz-win {
      background: linear-gradient(160deg, #0d2416 0%, #1a4a2e 100%);
      align-items: center; justify-content: center; text-align: center; padding: 40px 28px;
    }
    .win-trophy { font-size: 5rem; }
    .win-title { font-size: 2.4rem; font-weight: 900; margin-top: 10px; }
    .win-sub { font-size: .95rem; color: rgba(255,255,255,.6); margin-top: 8px; }
    .win-badge { display: inline-block; margin-top: 22px; padding: 10px 24px; border-radius: 12px;
      background: rgba(243,156,18,.12); border: 1px solid rgba(243,156,18,.35); font-size: .9rem; font-weight: 700; color: var(--gold); }
    .win-actions { display: flex; flex-direction: column; gap: 11px; margin-top: 28px; width: 100%; max-width: 290px; }
    .win-btn { padding: 15px; border-radius: var(--radius-md); border: none; font-size: .95rem; font-weight: 700; cursor: pointer; transition: transform .1s; }
    .win-btn:active { transform: scale(.97); }
    .win-btn-go { background: var(--green); color: white; }
    .win-btn-home { background: var(--surface); color: white; }
  </style>
</head>
<body>

<div id="flash" class="flash-overlay"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BROWSE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="browse" class="screen active">
  <div class="browse-header">
    <a href="index.html" class="back-link">&#8592; Accueil</a>
    <h1>&#128218; Vocabulaire</h1>
  </div>
  <div class="mode-bar">
    <div class="mode-toggle">
      <button class="mode-btn active" onclick="showMode('browse')">&#128218; Fiches</button>
      <button class="mode-btn" onclick="showMode('quiz')">&#127918; Quiz</button>
    </div>
  </div>
  <div class="theme-tabs" id="theme-tabs"></div>
  <div class="vocab-grid" id="vocab-grid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="quiz-home" class="screen">
  <div class="quiz-header">
    <a href="#" class="back-link" onclick="showMode('browse');return false">&#8592; Retour</a>
    <h1>&#127918; Quiz Vocabulaire</h1>
  </div>
  <div class="mode-bar">
    <div class="mode-toggle">
      <button class="mode-btn" onclick="showMode('browse')">&#128218; Fiches</button>
      <button class="mode-btn active" onclick="showMode('quiz')">&#127918; Quiz</button>
    </div>
  </div>
  <div class="quiz-lists" id="quiz-lists"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ GAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="quiz-game" class="screen">
  <div class="game-topbar">
    <button class="g-back" onclick="showQuizHome()">&#8592;</button>
    <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
    <div class="g-counter" id="g-counter">&#128293; 0/0</div>
  </div>
  <div class="card-zone">
    <div id="game-card">
      <div class="big-word" id="big-word">‚Äî</div>
    </div>
    <div class="hint-row">
      <button class="hint-btn" id="hint-btn" onclick="showHint()">&#128161; Indice</button>
      <span class="hint-val" id="hint-val"></span>
    </div>
  </div>
  <div class="input-zone">
    <div class="input-row">
      <input id="answer-input" class="answer-input" type="text"
             placeholder="traduction fran√ßaise‚Ä¶"
             autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
             onkeydown="if(event.key==='Enter') validate()">
      <button class="validate-btn" onclick="validate()">&#10003;</button>
    </div>
    <div class="msg" id="msg"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ WRONG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="quiz-wrong" class="screen" onclick="clearIntervalAndRestart()">
  <div class="wr-icon">&#128128;</div>
  <div class="wr-title">Rat√© !</div>
  <div class="wr-verb" id="wr-verb"></div>
  <div class="wr-box">
    <div class="wr-box-lbl">La r√©ponse correcte :</div>
    <div class="wr-answer" id="wr-answer"></div>
  </div>
  <div class="wr-ex" id="wr-ex"></div>
  <div class="wr-count">Recommence dans <b id="wr-cd">3</b>s</div>
  <div class="wr-tap">Tap pour recommencer tout de suite</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ WIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="quiz-win" class="screen">
  <div class="win-trophy">&#127942;</div>
  <div class="win-title">Parfait !</div>
  <div class="win-sub" id="win-sub"></div>
  <div class="win-badge" id="win-badge"></div>
  <div class="win-actions">
    <button class="win-btn win-btn-go" onclick="restartGame()">&#9654; Rejouer</button>
    <button class="win-btn win-btn-home" onclick="showQuizHome()">&#8592; Choisir une liste</button>
  </div>
</div>

<script src="data/vocabulaire.js"></script>
<script src="shared/engine.js"></script>
<script>
const PREFIX = 'vv';
let currentMode = 'browse';
let currentTheme = VOCAB_THEMES[0].id;

// ‚îÄ‚îÄ Screen ‚îÄ‚îÄ
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showMode(mode) {
  currentMode = mode;
  if (mode === 'browse') {
    renderBrowse();
    showScreen('browse');
  } else {
    renderQuizHome();
    showScreen('quiz-home');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BROWSE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBrowse() {
  renderThemeTabs();
  renderVocabCards();
}

function renderThemeTabs() {
  const tabs = document.getElementById('theme-tabs');
  tabs.innerHTML = VOCAB_THEMES.map(t =>
    `<button class="theme-btn${currentTheme===t.id?' active':''}" onclick="setTheme('${t.id}',this)">${t.emoji} ${t.label}</button>`
  ).join('');
}

function setTheme(id, btn) {
  currentTheme = id;
  document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderVocabCards();
}

function renderVocabCards() {
  const theme = VOCAB_THEMES.find(t => t.id === currentTheme);
  if (!theme) return;
  const grid = document.getElementById('vocab-grid');
  grid.innerHTML = theme.words.map((w, i) => `
    <div class="vocab-card" onclick="this.classList.toggle('flipped')">
      <div class="vc-inner">
        <div class="vc-front">
          <div class="vc-es">${w.es}</div>
          <div class="vc-tap">tap pour retourner</div>
        </div>
        <div class="vc-back">
          <div class="vc-fr">${w.fr}</div>
          <div class="vc-ex">${w.ex}</div>
        </div>
      </div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentList = null;
let deck = [];
let idx = 0;
let hintUsed = false;
let wrongTimer = null;

function renderQuizHome() {
  const sec = document.getElementById('quiz-lists');
  // Build quiz lists from themes
  const lists = [
    { id:'tout', emoji:'üî•', label:'Tous les mots', desc:'Tout le vocabulaire',
      f: () => true, getWords: () => VOCAB_THEMES.flatMap(t => t.words) },
    ...VOCAB_THEMES.map(t => ({
      id: t.id, emoji: t.emoji, label: t.label, desc: `${t.words.length} mots`,
      f: null, getWords: () => t.words
    }))
  ];

  sec.innerHTML = lists.map(l => {
    const words = l.getWords();
    const n = words.length;
    const best = getBest(PREFIX, l.id);
    let scoreStr;
    if (best === 0) scoreStr = '<span style="color:rgba(255,255,255,.25)">Jamais jou√©</span>';
    else if (best === n) scoreStr = `<span class="done-badge">‚úì Compl√©t√© ! (${n}/${n})</span>`;
    else scoreStr = `Meilleur : <b>${best}/${n}</b>`;
    return `
    <div class="list-card" onclick="startQuiz('${l.id}')">
      <div class="lc-emoji">${l.emoji}</div>
      <div class="lc-body">
        <div class="lc-name">${l.label}</div>
        <div class="lc-desc">${n} mots ‚Äî ${l.desc}</div>
        <div class="lc-score">${scoreStr}</div>
      </div>
      <div class="lc-arrow">‚Ä∫</div>
    </div>`;
  }).join('');

  // Store lists for lookup
  window._vocabQuizLists = lists;
}

function showQuizHome() {
  if (wrongTimer) { clearInterval(wrongTimer); wrongTimer = null; }
  renderQuizHome();
  showScreen('quiz-home');
}

function startQuiz(id) {
  currentList = window._vocabQuizLists.find(l => l.id === id);
  if (!currentList) return;
  deck = shuffle(currentList.getWords());
  idx = 0; hintUsed = false;
  addRun(PREFIX, id);
  renderWord(false);
  showScreen('quiz-game');
  setTimeout(() => document.getElementById('answer-input').focus(), 280);
}

function renderWord(animate) {
  const w = deck[idx];
  const input = document.getElementById('answer-input');
  const msg = document.getElementById('msg');
  input.value = ''; input.className = 'answer-input';
  msg.textContent = ''; msg.className = 'msg';
  document.getElementById('hint-val').textContent = '';
  document.getElementById('hint-btn').style.display = '';
  hintUsed = false;

  const pct = deck.length ? (idx / deck.length) * 100 : 0;
  document.getElementById('prog-fill').style.width = pct + '%';
  document.getElementById('g-counter').textContent = 'üî• ' + idx + '/' + deck.length;
  document.getElementById('big-word').textContent = w ? w.es : '‚Äî';

  if (animate) {
    const card = document.getElementById('game-card');
    card.style.transition = 'none';
    card.style.transform = 'translateY(48px)'; card.style.opacity = '0';
    requestAnimationFrame(() => requestAnimationFrame(() => {
      card.style.transition = 'transform .35s ease, opacity .35s ease';
      card.style.transform = 'translateY(0)'; card.style.opacity = '1';
    }));
  }
  setTimeout(() => document.getElementById('answer-input').focus(), 50);
}

function validate() {
  const input = document.getElementById('answer-input');
  const w = deck[idx];
  if (!w || !input.value.trim()) return;
  if (checkAnswer(input.value, w.ans)) onCorrect();
  else onWrong(w);
}

function onCorrect() {
  const input = document.getElementById('answer-input');
  const msg = document.getElementById('msg');
  const card = document.getElementById('game-card');
  input.className = 'answer-input ok';
  msg.textContent = '‚úì Bravo !'; msg.className = 'msg ok-msg';
  card.style.transition = 'transform .28s ease, opacity .28s ease';
  card.style.transform = 'translateY(-48px)'; card.style.opacity = '0';
  idx++;
  setBest(PREFIX, currentList.id, idx);
  if (idx >= deck.length) setTimeout(() => showWin(), 300);
  else setTimeout(() => renderWord(true), 300);
}

function onWrong(w) {
  const input = document.getElementById('answer-input');
  const card = document.getElementById('game-card');
  const flash = document.getElementById('flash');
  input.className = 'answer-input ko';
  card.classList.remove('shaking'); void card.offsetWidth; card.classList.add('shaking');
  flash.classList.add('on'); setTimeout(() => flash.classList.remove('on'), 320);

  setTimeout(() => {
    document.getElementById('wr-verb').textContent = w.es + ' ‚Üí ???';
    document.getElementById('wr-answer').textContent = w.fr;
    document.getElementById('wr-ex').textContent = '¬´ ' + w.ex + ' ¬ª';
    let cd = 3;
    document.getElementById('wr-cd').textContent = cd;
    showScreen('quiz-wrong');
    wrongTimer = setInterval(() => {
      cd--;
      document.getElementById('wr-cd').textContent = cd;
      if (cd <= 0) clearIntervalAndRestart();
    }, 1000);
  }, 550);
}

function clearIntervalAndRestart() {
  if (wrongTimer) { clearInterval(wrongTimer); wrongTimer = null; }
  restartGame();
}

function restartGame() {
  deck = shuffle(currentList.getWords());
  idx = 0; hintUsed = false;
  addRun(PREFIX, currentList.id);
  const card = document.getElementById('game-card');
  card.style.transition = ''; card.style.transform = ''; card.style.opacity = '';
  renderWord(false);
  showScreen('quiz-game');
  setTimeout(() => document.getElementById('answer-input').focus(), 280);
}

function showHint() {
  if (hintUsed) return;
  hintUsed = true;
  const w = deck[idx];
  const a = w.ans[0];
  document.getElementById('hint-val').textContent = a.charAt(0).toUpperCase() + '‚Ä¶ (' + a.length + ' lettres)';
  document.getElementById('hint-btn').style.display = 'none';
}

function showWin() {
  const n = deck.length;
  const best = getBest(PREFIX, currentList.id);
  document.getElementById('win-sub').textContent = `${n} mots sans faute ! üéâ`;
  document.getElementById('win-badge').textContent = n >= best ? 'üèÜ Nouveau record !' : `üèÜ Record : ${best}/${n}`;
  showScreen('quiz-win');
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
renderBrowse();
</script>
</body>
</html>
