<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fiches Verbes Espagnols</title>
  <link rel="stylesheet" href="shared/style.css">
  <style>
    body { background: var(--bg-light); color: #1a1a2e; }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      background: linear-gradient(135deg, var(--red), var(--red-dark));
      color: white; padding: 14px 28px;
      display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { font-size: 1.35rem; font-weight: 800; letter-spacing: -0.5px; }
    header span { font-size: 0.85rem; opacity: .8; }

    /* ‚îÄ‚îÄ Controls ‚îÄ‚îÄ */
    .controls {
      background: white; border-bottom: 2px solid #e8e0d0;
      padding: 10px 24px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
    }
    .btn {
      padding: 7px 14px; border-radius: 8px; border: none; cursor: pointer;
      font-size: 0.82rem; font-weight: 700; transition: transform .15s, box-shadow .15s;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.18); }
    .btn-red    { background: var(--red);      color: white; }
    .btn-dark   { background: var(--bg-card);  color: white; }
    .btn-gold   { background: var(--gold);     color: white; }
    .btn-out    { background: transparent; border: 2px solid var(--red); color: var(--red); }
    .filter-group { display: flex; gap: 6px; margin-left: auto; }
    .fbtn {
      padding: 5px 12px; border-radius: 20px; border: 2px solid #ddd;
      background: white; cursor: pointer; font-size: 0.78rem; color: #888; transition: all .2s;
    }
    .fbtn.active { background: var(--red); color: white; border-color: var(--red); }
    #progress { font-size: 0.82rem; color: #999; white-space: nowrap; padding-left: 4px; }

    /* ‚îÄ‚îÄ Card Grid ‚îÄ‚îÄ */
    .card-grid {
      display: flex; flex-wrap: wrap; gap: 18px;
      padding: 24px; justify-content: center; max-width: 1440px; margin: 0 auto;
    }

    /* ‚îÄ‚îÄ Flip Card ‚îÄ‚îÄ */
    :root { --card-w: 340px; --card-h: 310px; }
    .flip-card {
      width: var(--card-w); height: var(--card-h);
      perspective: 1200px; position: relative;
    }
    .flip-card-inner {
      width: 100%; height: 100%;
      transition: transform .55s ease; transform-style: preserve-3d; position: relative;
    }
    .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
    .fc-front, .fc-back {
      position: absolute; inset: 0; backface-visibility: hidden;
      border-radius: 13px; padding: 16px 18px;
      box-shadow: 0 4px 18px rgba(0,0,0,.1);
    }

    /* Front */
    .fc-front { background: white; border-top: 5px solid var(--red); display: flex; flex-direction: column; }
    .fc-front.learned-card { border-top-color: var(--green); }
    .v-name  { font-size: 1.85rem; font-weight: 900; color: var(--red); line-height: 1; }
    .v-trans { font-size: 0.82rem; color: #888; font-style: italic; margin-top: 2px; }
    .v-badge {
      display: inline-block; margin-top: 4px;
      font-size: 0.65rem; padding: 1px 7px; border-radius: 10px;
      background: #f0f0f0; color: #aaa;
    }
    .blanks {
      display: grid; grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 5px 10px; margin-top: 10px; flex: 1;
    }
    .b-row { display: flex; align-items: flex-end; gap: 5px; overflow: hidden; }
    .b-pro { font-size: 0.66rem; color: #bbb; width: 54px; flex-shrink: 0; text-align: right; line-height: 1.8; white-space: nowrap; }
    .b-input {
      flex: 1; border: none; border-bottom: 1.5px solid #e0e0e0;
      background: transparent; font-family: inherit; font-size: 0.82rem;
      color: var(--bg-card); outline: none; padding: 0 2px; height: 20px; min-width: 0;
    }
    .b-input:focus { border-bottom-color: var(--red); }
    .reveal-btn {
      margin-top: 8px; padding: 5px 0; width: 100%;
      background: var(--red); color: white; border: none; border-radius: 7px;
      font-size: 0.75rem; font-weight: 700; cursor: pointer; letter-spacing: .3px;
    }
    .reveal-btn:hover { background: var(--red-dark); }
    .back-actions {
      display: flex; gap: 8px; margin-top: auto; padding-top: 6px;
    }
    .back-btn {
      flex: 1; padding: 5px 0; border: none; border-radius: 7px;
      font-size: 0.72rem; font-weight: 700; cursor: pointer;
    }
    .back-btn-ret { background: rgba(255,255,255,.12); color: rgba(255,255,255,.8); }
    .back-btn-ret:hover { background: rgba(255,255,255,.22); }
    .back-btn-ok  { background: var(--green); color: white; }
    .back-btn-ok:hover { background: var(--green-dark); }
    .flip-card.learned .back-btn-ok { background: #888; }
    .check-badge {
      position: absolute; top: 10px; right: 12px;
      background: var(--green); color: white; border-radius: 50%;
      width: 22px; height: 22px; font-size: 0.7rem;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity .3s;
    }
    .flip-card.learned .check-badge { opacity: 1; }
    .flip-card.learned .v-name { color: var(--green); }

    /* Back */
    .fc-back {
      background: var(--bg-card); color: white;
      transform: rotateY(180deg); display: flex; flex-direction: column;
    }
    .fc-back .v-name  { color: var(--gold); }
    .fc-back .v-trans { color: rgba(255,255,255,.55); }
    .conj-grid {
      display: grid; grid-template-columns: auto 1fr auto 1fr;
      gap: 2px 8px; margin: 8px 0; font-size: 0.8rem;
    }
    .cg-pro  { color: rgba(255,255,255,.45); font-size: 0.68rem; align-self: center; }
    .cg-form { color: white; font-weight: 700; font-size: 0.85rem; }
    .tenses {
      background: rgba(255,255,255,.08); border-radius: 7px;
      padding: 5px 9px; font-size: 0.72rem; margin: 3px 0;
      color: rgba(255,255,255,.8); line-height: 1.7;
    }
    .tenses b { color: rgba(255,255,255,.45); font-weight: 400; }
    .tenses .t-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .tenses .t-sep { color: rgba(255,255,255,.2); }
    .examples { border-top: 1px solid rgba(255,255,255,.12); padding-top: 6px; margin-top: 4px; }
    .ex { font-size: 0.75rem; color: rgba(255,255,255,.72); font-style: italic; margin: 2px 0; }

    /* ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ */
    .print-section { display: none; }

    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      body { background: white !important; }
      header, .controls, .card-grid { display: none !important; }
      .print-section { display: block !important; }

      .print-page {
        width: 210mm; height: 296mm;
        display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr;
        gap: 5mm; padding: 8mm; page-break-after: always;
      }
      .print-page:last-child { page-break-after: avoid; }

      .pc {
        border-radius: 8px; padding: 6mm 6mm; overflow: hidden;
        display: flex; flex-direction: column;
      }
      .pc-f { border: 1.5px solid #ddd; border-top: 4px solid #c0392b; }
      .pc-inf  { font-size: 24pt; font-weight: 900; color: #c0392b; line-height: 1; }
      .pc-tr   { font-size: 9pt; color: #888; font-style: italic; margin-bottom: 6mm; }
      .pc-blanks {
        display: grid; grid-template-columns: auto 1fr auto 1fr;
        gap: 3pt 7pt; flex: 1;
      }
      .pc-pro   { color: #bbb; font-size: 7.5pt; align-self: center; text-align: right; }
      .pc-blank { border-bottom: 1pt solid #ddd; height: 18pt; }

      .pc-b { background: #1a2744 !important; color: white !important; border: none; }
      .pc-b .pc-inf { color: #f39c12 !important; }
      .pc-b .pc-tr  { color: rgba(255,255,255,.55) !important; margin-bottom: 3mm; }
      .pc-cg {
        display: grid; grid-template-columns: auto 1fr auto 1fr;
        gap: 2pt 7pt; margin-bottom: 3mm;
      }
      .pc-cgp { color: rgba(255,255,255,.45); font-size: 7pt; align-self: center; }
      .pc-cgf { color: white; font-weight: 700; font-size: 9pt; }
      .pc-tenses {
        background: rgba(255,255,255,.1); border-radius: 4pt;
        padding: 3pt 6pt; font-size: 7.5pt; color: rgba(255,255,255,.8);
        margin-bottom: 2.5mm;
      }
      .pc-exs { border-top: .5pt solid rgba(255,255,255,.15); padding-top: 2mm; }
      .pc-ex  { font-size: 7.5pt; color: rgba(255,255,255,.72); font-style: italic; margin: 1.5pt 0; }
    }
  </style>
</head>
<body>

<header>
  <h1>&#127466;&#127480; Fiches Verbes Espagnols</h1>
  <span id="verb-count">Fiches Verbes</span>
</header>

<div class="controls">
  <button class="btn btn-red"  onclick="printCards('front')">&#128424; Imprimer Rectos</button>
  <button class="btn btn-dark" onclick="printCards('back')">&#128424; Imprimer Versos</button>
  <button class="btn btn-out"  onclick="shuffleCards()">&#128256; M√©langer</button>
  <button class="btn btn-gold" onclick="resetLearned()">&#8635; R√©initialiser</button>
  <div class="filter-group">
    <button class="fbtn active" onclick="filterGroup('all',this)">Tous</button>
    <button class="fbtn" onclick="filterGroup('E',this)">Essentiels</button>
    <button class="fbtn" onclick="filterGroup('C',this)">Courants</button>
    <button class="fbtn" onclick="filterGroup('C2',this)">Courants +</button>
    <button class="fbtn" onclick="filterGroup('D1',this)">üè° Quotidien</button>
    <button class="fbtn" onclick="filterGroup('D2',this)">ü§ù Social</button>
    <button class="fbtn" onclick="filterGroup('D3',this)">üè• Sant√©</button>
    <button class="fbtn" onclick="filterGroup('D4',this)">üç≥ Cuisine</button>
    <button class="fbtn" onclick="filterGroup('D5',this)">‚õ∞Ô∏è Sport</button>
    <button class="fbtn" onclick="filterGroup('D6',this)">üè¢ Travail +</button>
    <button class="fbtn" onclick="filterGroup('D7',this)">üó∫Ô∏è Voyage +</button>
    <button class="fbtn" onclick="filterGroup('D8',this)">üí≠ √âmotions</button>
    <button class="fbtn" onclick="filterGroup('D9',this)">üîë Divers</button>
  </div>
  <span id="progress">0 / 176 ma√Ætris√©s</span>
</div>

<div id="card-grid" class="card-grid"></div>
<div id="print-section" class="print-section"></div>

<script src="data/verbs.js"></script>
<script src="data/conj_extra.js"></script>
<script>
const PRONOUNS = ['yo','t√∫','√©l/ella','nosotros','vosotros','ellos'];

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let currentFilter = 'all';
let displayedVerbs = [...VERBS];
let learned = new Set(JSON.parse(localStorage.getItem('es-learned') || '[]'));

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderCards(list) {
  const grid = document.getElementById('card-grid');
  grid.innerHTML = list.map((v, i) => buildCard(v, i)).join('');
  updateProgress();
}

function buildCard(v, i) {
  const isLearned = learned.has(v.inf);
  const leftConj  = v.conj.slice(0, 3);
  const rightConj = v.conj.slice(3);
  const leftPro   = PRONOUNS.slice(0, 3);
  const rightPro  = PRONOUNS.slice(3);
  const groupLabel = GROUP_LABELS[v.g] || v.g;
  const extra = CONJ_EXTRA[v.inf.toLowerCase()];

  const extraTenses = extra ? `
    <div class="t-row"><b>Fut.:</b> ${extra.fut[0]} &nbsp;<span class="t-sep">|</span>&nbsp; <b>Cond.:</b> ${extra.cond[0]}</div>
    <div class="t-row"><b>Subj.:</b> ${extra.subj[0]} &nbsp;<span class="t-sep">|</span>&nbsp; <b>G√©r.:</b> ${extra.ger} &nbsp;<span class="t-sep">|</span>&nbsp; <b>PP:</b> ${extra.pp}</div>` : '';

  return `
  <div class="flip-card${isLearned ? ' learned' : ''}" id="c${i}" data-inf="${v.inf}" data-g="${v.g}">
    <div class="flip-card-inner">

      <div class="fc-front${isLearned ? ' learned-card' : ''}">
        <div class="check-badge">&#10003;</div>
        <div class="v-name">${v.inf}</div>
        <div class="v-trans">${v.tr}</div>
        <div class="v-badge">${groupLabel}</div>
        <div class="blanks">
          ${leftPro.map(p => `<div class="b-row"><div class="b-pro">${p}</div><input class="b-input" type="text" autocomplete="off" spellcheck="false"></div>`).join('')}
          ${rightPro.map(p => `<div class="b-row"><div class="b-pro">${p}</div><input class="b-input" type="text" autocomplete="off" spellcheck="false"></div>`).join('')}
        </div>
        <button class="reveal-btn" onclick="revealCard(${i})">R√©v√©ler &#9654;</button>
      </div>

      <div class="fc-back">
        <div class="v-name">${v.inf}</div>
        <div class="v-trans">${v.tr}</div>
        <div class="conj-grid">
          ${leftPro.map((p,j) => `<div class="cg-pro">${p}</div><div class="cg-form">${leftConj[j]}</div>`).join('')}
          ${rightPro.map((p,j) => `<div class="cg-pro">${p}</div><div class="cg-form">${rightConj[j]}</div>`).join('')}
        </div>
        <div class="tenses">
          <div class="t-row"><b>Imp.:</b> ${v.imp} &nbsp;<span class="t-sep">|</span>&nbsp; <b>Pret.:</b> ${v.ps}</div>
          ${extraTenses}
        </div>
        <div class="examples">
          ${v.ex.map(e => `<div class="ex">&#9658; ${e}</div>`).join('')}
        </div>
        <div class="back-actions">
          <button class="back-btn back-btn-ret" onclick="flipBack(${i})">&#8592; Retour</button>
          <button class="back-btn back-btn-ok"  onclick="toggleLearned(${i})" id="ok${i}">${isLearned ? '&#10003; Ma√Ætris√©' : '&#10003; Ma√Ætris√© ?'}</button>
        </div>
      </div>

    </div>
  </div>`;
}

function revealCard(i) {
  document.getElementById('c' + i).classList.add('flipped');
}

function flipBack(i) {
  document.getElementById('c' + i).classList.remove('flipped');
}

function toggleLearned(i) {
  const card = document.getElementById('c' + i);
  const inf  = card.dataset.inf;
  card.classList.toggle('learned');
  const ok = card.classList.contains('learned');
  if (ok) learned.add(inf); else learned.delete(inf);
  document.getElementById('ok' + i).innerHTML = ok ? '&#10003; Ma√Ætris√© !' : '&#10003; Ma√Ætris√© ?';
  localStorage.setItem('es-learned', JSON.stringify([...learned]));
  updateProgress();
}

function updateProgress() {
  const total   = document.querySelectorAll('.flip-card').length;
  const done    = document.querySelectorAll('.flip-card.learned').length;
  document.getElementById('progress').textContent = `${done} / ${total} ma√Ætris√©s`;
  document.getElementById('verb-count').textContent =
    `${total} verbes ¬∑ ${done} ma√Ætris√©s`;
}

function filterGroup(g, btn) {
  currentFilter = g;
  document.querySelectorAll('.fbtn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  displayedVerbs = g === 'all' ? [...VERBS] : VERBS.filter(v => v.g === g);
  renderCards(displayedVerbs);
}

function shuffleCards() {
  for (let i = displayedVerbs.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [displayedVerbs[i], displayedVerbs[j]] = [displayedVerbs[j], displayedVerbs[i]];
  }
  renderCards(displayedVerbs);
}

function resetLearned() {
  learned.clear();
  localStorage.removeItem('es-learned');
  renderCards(displayedVerbs);
}

// ‚îÄ‚îÄ Print ‚îÄ‚îÄ
function printCards(side) {
  buildPrintSection(side);
  window.print();
  setTimeout(() => { document.getElementById('print-section').innerHTML = ''; }, 1000);
}

function buildPrintSection(side) {
  const ps = document.getElementById('print-section');
  const pages = [];
  const list  = VERBS;

  for (let i = 0; i < list.length; i += 4) {
    const chunk = list.slice(i, i + 4);
    while (chunk.length < 4) chunk.push(null);

    if (side === 'front') {
      pages.push(buildPrintPage(chunk, 'front'));
    } else {
      const swapped = [chunk[1], chunk[0], chunk[3], chunk[2]];
      pages.push(buildPrintPage(swapped, 'back'));
    }
  }
  ps.innerHTML = pages.join('');
}

function buildPrintPage(cards, side) {
  return `<div class="print-page">${cards.map(v => v ? buildPrintCard(v, side) : '<div class="pc"></div>').join('')}</div>`;
}

function buildPrintCard(v, side) {
  const leftPro  = PRONOUNS.slice(0, 3);
  const rightPro = PRONOUNS.slice(3);
  const leftConj = v.conj.slice(0, 3);
  const rightConj= v.conj.slice(3);

  if (side === 'front') {
    return `
    <div class="pc pc-f">
      <div class="pc-inf">${v.inf}</div>
      <div class="pc-tr">${v.tr}</div>
      <div class="pc-blanks">
        ${leftPro.map(p  => `<div class="pc-pro">${p}</div><div class="pc-blank"></div>`).join('')}
        ${rightPro.map(p => `<div class="pc-pro">${p}</div><div class="pc-blank"></div>`).join('')}
      </div>
    </div>`;
  } else {
    return `
    <div class="pc pc-b">
      <div class="pc-inf">${v.inf}</div>
      <div class="pc-tr">${v.tr}</div>
      <div class="pc-cg">
        ${leftPro.map((p,j)  => `<div class="pc-cgp">${p}</div><div class="pc-cgf">${leftConj[j]}</div>`).join('')}
        ${rightPro.map((p,j) => `<div class="pc-cgp">${p}</div><div class="pc-cgf">${rightConj[j]}</div>`).join('')}
      </div>
      <div class="pc-tenses">Imp.: ${v.imp} &nbsp;|&nbsp; Pret.: ${v.ps}${(() => { const x = CONJ_EXTRA[v.inf.toLowerCase()]; return x ? ` &nbsp;|&nbsp; Fut.: ${x.fut[0]} &nbsp;|&nbsp; Subj.: ${x.subj[0]} &nbsp;|&nbsp; PP: ${x.pp}` : ''; })()}</div>
      <div class="pc-exs">
        ${v.ex.map(e => `<div class="pc-ex">&#9658; ${e}</div>`).join('')}
      </div>
    </div>`;
  }
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
renderCards(displayedVerbs);
</script>
</body>
</html>
