<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#0f1628">
  <title>Verbo ğŸ‡ªğŸ‡¸</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%; height: 100dvh;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: #0f1628; color: white;
      overflow: hidden;
    }

    /* â”€â”€ Screens â”€â”€ */
    .screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      opacity: 0; pointer-events: none;
      transform: translateY(16px);
      transition: opacity .22s ease, transform .22s ease;
    }
    .screen.active { opacity: 1; pointer-events: all; transform: translateY(0); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOME
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #s-home {
      background: linear-gradient(160deg, #0f1628 0%, #1c2d50 100%);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
    }

    .home-header { padding: 52px 26px 14px; text-align: center; }
    .home-logo   { font-size: 3rem; font-weight: 900; letter-spacing: -2px; line-height: 1; }
    .home-logo em { color: #f39c12; font-style: normal; }
    .home-sub    { font-size: 0.85rem; color: rgba(255,255,255,.45); margin-top: 6px; }

    .tabs {
      display: flex; margin: 18px 22px 0;
      background: rgba(255,255,255,.07); border-radius: 12px; padding: 4px; gap: 2px;
    }
    .tab-btn {
      flex: 1; padding: 9px 4px; border: none; border-radius: 9px;
      font-size: 0.76rem; font-weight: 700; cursor: pointer;
      background: transparent; color: rgba(255,255,255,.45); transition: all .2s;
    }
    .tab-btn.active { background: #c0392b; color: white; }

    .list-section { padding: 14px 22px 48px; display: flex; flex-direction: column; gap: 9px; }

    .list-card {
      border-radius: 14px; padding: 14px 16px;
      display: flex; align-items: center; gap: 13px;
      cursor: pointer; transition: transform .12s;
      background: rgba(255,255,255,.07); border: 1px solid rgba(255,255,255,.08);
      -webkit-tap-highlight-color: transparent;
    }
    .list-card:active { transform: scale(.97); }
    .lc-emoji  { font-size: 1.7rem; width: 42px; text-align: center; flex-shrink: 0; }
    .lc-body   { flex: 1; min-width: 0; }
    .lc-name   { font-size: .95rem; font-weight: 700; }
    .lc-desc   { font-size: .72rem; color: rgba(255,255,255,.45); margin-top: 2px; }
    .lc-score  { font-size: .72rem; margin-top: 3px; color: rgba(255,255,255,.35); }
    .lc-score b { color: #f39c12; font-weight: 700; }
    .lc-score .done-badge { color: #27ae60; font-weight: 700; }
    .lc-arrow  { font-size: 1.3rem; color: rgba(255,255,255,.2); flex-shrink: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GAME
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #s-game {
      background: linear-gradient(160deg, #0f1628 0%, #1c2d50 100%);
    }

    .game-topbar {
      display: flex; align-items: center; gap: 10px;
      padding: 50px 18px 10px; flex-shrink: 0;
    }
    .g-back {
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255,255,255,.1); border: none; color: white;
      font-size: 1rem; cursor: pointer; display: flex;
      align-items: center; justify-content: center; flex-shrink: 0;
      -webkit-tap-highlight-color: transparent;
    }
    .prog-track {
      flex: 1; height: 5px; background: rgba(255,255,255,.1);
      border-radius: 3px; overflow: hidden;
    }
    .prog-fill {
      height: 100%; background: linear-gradient(90deg, #c0392b, #f39c12);
      border-radius: 3px; transition: width .35s ease; width: 0%;
    }
    .g-counter { font-size: .82rem; font-weight: 700; color: #f39c12; white-space: nowrap; flex-shrink: 0; }

    /* Card zone */
    .card-zone {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 10px 28px; min-height: 0;
    }
    .run-tag {
      font-size: .65rem; letter-spacing: 1.5px; text-transform: uppercase;
      color: rgba(255,255,255,.28); margin-bottom: 6px;
    }
    .list-tag {
      font-size: .72rem; padding: 3px 11px; border-radius: 20px;
      background: rgba(255,255,255,.09); color: rgba(255,255,255,.45);
      margin-bottom: 18px;
    }
    #game-card {
      text-align: center;
      transition: transform .3s ease, opacity .3s ease;
    }
    .big-verb {
      font-size: clamp(2.6rem, 11vw, 4.2rem);
      font-weight: 900; letter-spacing: -2px; line-height: 1;
    }
    .hint-row {
      display: flex; align-items: center; justify-content: center;
      gap: 8px; margin-top: 18px; min-height: 32px;
    }
    .hint-btn {
      padding: 6px 16px; border-radius: 20px;
      background: rgba(255,255,255,.07); border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.45); font-size: .74rem; cursor: pointer;
      transition: background .2s;
      -webkit-tap-highlight-color: transparent;
    }
    .hint-btn:active { background: rgba(255,255,255,.15); }
    .hint-val { font-size: .8rem; color: rgba(243,156,18,.85); font-style: italic; }

    /* Input zone */
    .input-zone { padding: 0 20px 36px; flex-shrink: 0; }
    .input-row  { display: flex; gap: 9px; align-items: stretch; }
    #answer-input {
      flex: 1; padding: 15px 16px;
      background: rgba(255,255,255,.09); border: 2px solid rgba(255,255,255,.13);
      border-radius: 14px; color: white; font-size: 1.05rem;
      outline: none; font-family: inherit;
      transition: border-color .2s, background .2s;
      -webkit-tap-highlight-color: transparent;
    }
    #answer-input::placeholder { color: rgba(255,255,255,.28); }
    #answer-input:focus  { border-color: rgba(255,255,255,.3); }
    #answer-input.ok     { border-color: #27ae60; background: rgba(39,174,96,.13); }
    #answer-input.ko     { border-color: #c0392b; background: rgba(192,57,43,.13); }
    #ok-btn {
      width: 52px; border-radius: 14px; background: #c0392b; border: none;
      color: white; font-size: 1.3rem; cursor: pointer; flex-shrink: 0;
      transition: transform .1s; display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
    }
    #ok-btn:active { transform: scale(.92); }
    .msg {
      text-align: center; margin-top: 9px; font-size: .83rem;
      min-height: 20px; color: rgba(255,255,255,.5);
    }
    .msg.ok-msg { color: #27ae60; font-weight: 700; }
    .msg.ko-msg { color: #e74c3c; font-weight: 700; }

    /* â”€â”€ Animations â”€â”€ */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      15%      { transform: translateX(-9px); }
      30%      { transform: translateX(9px); }
      50%      { transform: translateX(-6px); }
      70%      { transform: translateX(6px); }
      90%      { transform: translateX(-3px); }
    }
    .shaking { animation: shake .45s ease; }

    #flash {
      position: fixed; inset: 0; z-index: 80;
      background: rgba(192,57,43,.4);
      opacity: 0; pointer-events: none;
      transition: opacity .15s ease;
    }
    #flash.on { opacity: 1; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WRONG PAUSE (overlay)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #s-wrong {
      background: rgba(5,8,18,.92);
      align-items: center; justify-content: center;
      text-align: center; padding: 40px 30px; z-index: 100;
    }
    .wr-icon   { font-size: 3.5rem; }
    .wr-title  { font-size: 2.2rem; font-weight: 900; color: #e74c3c; margin-top: 8px; }
    .wr-verb   { font-size: 1rem; color: rgba(255,255,255,.5); margin-top: 10px; }
    .wr-box    {
      margin-top: 18px; padding: 14px 28px; border-radius: 14px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.1);
    }
    .wr-box-lbl { font-size: .72rem; color: rgba(255,255,255,.35); margin-bottom: 4px; }
    .wr-answer  { font-size: 1.25rem; font-weight: 800; color: #f39c12; }
    .wr-count   { margin-top: 28px; font-size: .83rem; color: rgba(255,255,255,.35); }
    .wr-count b { color: rgba(255,255,255,.6); }
    .wr-tap     { margin-top: 10px; font-size: .75rem; color: rgba(255,255,255,.2); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WIN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #s-win {
      background: linear-gradient(160deg, #0d2416 0%, #1a4a2e 100%);
      align-items: center; justify-content: center;
      text-align: center; padding: 40px 28px;
    }
    .win-trophy { font-size: 5rem; }
    .win-title  { font-size: 2.4rem; font-weight: 900; margin-top: 10px; }
    .win-sub    { font-size: .95rem; color: rgba(255,255,255,.6); margin-top: 8px; }
    .win-badge  {
      display: inline-block; margin-top: 22px;
      padding: 10px 24px; border-radius: 12px;
      background: rgba(243,156,18,.12); border: 1px solid rgba(243,156,18,.35);
      font-size: .9rem; font-weight: 700; color: #f39c12;
    }
    .win-actions { display: flex; flex-direction: column; gap: 11px; margin-top: 28px; width: 100%; max-width: 290px; }
    .win-btn {
      padding: 15px; border-radius: 14px; border: none;
      font-size: .95rem; font-weight: 700; cursor: pointer;
      transition: transform .1s;
      -webkit-tap-highlight-color: transparent;
    }
    .win-btn:active { transform: scale(.97); }
    .win-btn-go   { background: #27ae60; color: white; }
    .win-btn-home { background: rgba(255,255,255,.1); color: white; }
  </style>
</head>
<body>

<div id="flash"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â• -->
<div id="s-home" class="screen active">
  <div class="home-header">
    <div class="home-logo">Verb<em>o</em> &#127466;&#127480;</div>
    <div class="home-sub">Apprends les verbes espagnols par le jeu</div>
  </div>
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('niveau',this)">Niveau</button>
    <button class="tab-btn" onclick="switchTab('theme',this)">ThÃ¨me</button>
    <button class="tab-btn" onclick="switchTab('grammaire',this)">Grammaire</button>
  </div>
  <div id="list-section" class="list-section"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• GAME â•â•â•â•â•â•â•â•â•â•â• -->
<div id="s-game" class="screen">
  <div class="game-topbar">
    <button class="g-back" onclick="goHome()">&#8592;</button>
    <div class="prog-track"><div class="prog-fill" id="prog-fill"></div></div>
    <div class="g-counter" id="g-counter">&#128293; 0/0</div>
  </div>

  <div class="card-zone">
    <div class="run-tag" id="run-tag">Run #1</div>
    <div class="list-tag" id="list-tag"></div>
    <div id="game-card">
      <div class="big-verb" id="big-verb">â€”</div>
    </div>
    <div class="hint-row">
      <button class="hint-btn" id="hint-btn" onclick="showHint()">&#128161; Indice</button>
      <span class="hint-val" id="hint-val"></span>
    </div>
  </div>

  <div class="input-zone">
    <div class="input-row">
      <input id="answer-input" type="text"
             placeholder="traduction franÃ§aiseâ€¦"
             autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
             onkeydown="if(event.key==='Enter') validate()">
      <button id="ok-btn" onclick="validate()">&#10003;</button>
    </div>
    <div class="msg" id="msg"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• WRONG PAUSE â•â•â•â•â•â•â•â•â•â•â• -->
<div id="s-wrong" class="screen" onclick="clearIntervalAndRestart()">
  <div class="wr-icon">&#128128;</div>
  <div class="wr-title">RatÃ© !</div>
  <div class="wr-verb" id="wr-verb"></div>
  <div class="wr-box">
    <div class="wr-box-lbl">La rÃ©ponse correcte :</div>
    <div class="wr-answer" id="wr-answer"></div>
  </div>
  <div class="wr-count">Recommence dans <b id="wr-cd">3</b>s</div>
  <div class="wr-tap">Tap pour recommencer tout de suite</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• WIN â•â•â•â•â•â•â•â•â•â•â• -->
<div id="s-win" class="screen">
  <div class="win-trophy">&#127942;</div>
  <div class="win-title">Parfait !</div>
  <div class="win-sub" id="win-sub"></div>
  <div class="win-badge" id="win-badge"></div>
  <div class="win-actions">
    <button class="win-btn win-btn-go"   onclick="restartGame()">&#9654; Rejouer</button>
    <button class="win-btn win-btn-home" onclick="goHome()">&#8592; Choisir une liste</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VERB DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const VERBS = [
  // â”€â”€ Essentiels â”€â”€
  { g:'E', inf:'Ser',        tr:'Ãªtre (permanent)',          ans:['Ãªtre','etre'] },
  { g:'E', inf:'Estar',      tr:'Ãªtre (Ã©tat / lieu)',        ans:['Ãªtre','etre'] },
  { g:'E', inf:'Tener',      tr:'avoir',                     ans:['avoir'] },
  { g:'E', inf:'Hacer',      tr:'faire',                     ans:['faire'] },
  { g:'E', inf:'Ir',         tr:'aller',                     ans:['aller'] },
  { g:'E', inf:'Venir',      tr:'venir',                     ans:['venir'] },
  { g:'E', inf:'Poder',      tr:'pouvoir',                   ans:['pouvoir'] },
  { g:'E', inf:'Querer',     tr:'vouloir / aimer',           ans:['vouloir','aimer'] },
  { g:'E', inf:'Decir',      tr:'dire',                      ans:['dire'] },
  { g:'E', inf:'Ver',        tr:'voir',                      ans:['voir'] },
  { g:'E', inf:'Dar',        tr:'donner',                    ans:['donner'] },
  { g:'E', inf:'Saber',      tr:'savoir',                    ans:['savoir'] },
  { g:'E', inf:'Conocer',    tr:'connaÃ®tre',                 ans:['connaÃ®tre','connaitre'] },
  { g:'E', inf:'Hablar',     tr:'parler',                    ans:['parler'] },
  { g:'E', inf:'Comer',      tr:'manger',                    ans:['manger'] },
  { g:'E', inf:'Beber',      tr:'boire',                     ans:['boire'] },
  { g:'E', inf:'Pedir',      tr:'demander / commander',      ans:['demander','commander'] },
  { g:'E', inf:'Salir',      tr:'sortir',                    ans:['sortir'] },
  { g:'E', inf:'Llegar',     tr:'arriver',                   ans:['arriver'] },
  { g:'E', inf:'Volver',     tr:'revenir',                   ans:['revenir','rentrer'] },
  { g:'E', inf:'Dormir',     tr:'dormir',                    ans:['dormir'] },
  { g:'E', inf:'Levantarse', tr:'se lever',                  ans:['se lever','lever'] },
  { g:'E', inf:'Sentarse',   tr:"s'asseoir",                 ans:["s'asseoir",'asseoir'] },
  { g:'E', inf:'Comprar',    tr:'acheter',                   ans:['acheter'] },
  { g:'E', inf:'Pagar',      tr:'payer',                     ans:['payer'] },
  { g:'E', inf:'Gustar',     tr:'plaire / aimer',            ans:['plaire','aimer'] },
  // â”€â”€ Courants â”€â”€
  { g:'C', inf:'Vivir',      tr:'vivre',                     ans:['vivre'] },
  { g:'C', inf:'Trabajar',   tr:'travailler',                ans:['travailler'] },
  { g:'C', inf:'Estudiar',   tr:'Ã©tudier',                   ans:['Ã©tudier','etudier'] },
  { g:'C', inf:'Aprender',   tr:'apprendre',                 ans:['apprendre'] },
  { g:'C', inf:'EnseÃ±ar',    tr:'enseigner / montrer',       ans:['enseigner','montrer'] },
  { g:'C', inf:'Escribir',   tr:'Ã©crire',                    ans:['Ã©crire','ecrire'] },
  { g:'C', inf:'Leer',       tr:'lire',                      ans:['lire'] },
  { g:'C', inf:'Escuchar',   tr:'Ã©couter',                   ans:['Ã©couter','ecouter'] },
  { g:'C', inf:'Mirar',      tr:'regarder',                  ans:['regarder'] },
  { g:'C', inf:'Buscar',     tr:'chercher',                  ans:['chercher'] },
  { g:'C', inf:'Encontrar',  tr:'trouver / rencontrer',      ans:['trouver','rencontrer'] },
  { g:'C', inf:'Perder',     tr:'perdre / rater',            ans:['perdre','rater'] },
  { g:'C', inf:'Ganar',      tr:'gagner',                    ans:['gagner'] },
  { g:'C', inf:'Gastar',     tr:'dÃ©penser',                  ans:['dÃ©penser','depenser'] },
  { g:'C', inf:'Ahorrar',    tr:'Ã©conomiser',                ans:['Ã©conomiser','economiser'] },
  { g:'C', inf:'Llevar',     tr:'porter / emmener',          ans:['porter','emmener'] },
  { g:'C', inf:'Traer',      tr:'apporter',                  ans:['apporter'] },
  { g:'C', inf:'Poner',      tr:'mettre / poser',            ans:['mettre','poser'] },
  { g:'C', inf:'Ponerse',    tr:'se mettre / devenir',       ans:['se mettre','mettre','devenir'] },
  { g:'C', inf:'Abrir',      tr:'ouvrir',                    ans:['ouvrir'] },
  { g:'C', inf:'Cerrar',     tr:'fermer',                    ans:['fermer'] },
  { g:'C', inf:'Empezar',    tr:'commencer',                 ans:['commencer'] },
  { g:'C', inf:'Terminar',   tr:'finir / terminer',          ans:['finir','terminer'] },
  { g:'C', inf:'Esperar',    tr:'attendre / espÃ©rer',        ans:['attendre','espÃ©rer','esperer'] },
  { g:'C', inf:'Ayudar',     tr:'aider',                     ans:['aider'] },
  { g:'C', inf:'Necesitar',  tr:'avoir besoin de',           ans:['avoir besoin','nÃ©cessiter','necessiter'] },
  { g:'C', inf:'Preferir',   tr:'prÃ©fÃ©rer',                  ans:['prÃ©fÃ©rer','preferer'] },
  { g:'C', inf:'Entender',   tr:'comprendre',                ans:['comprendre'] },
  { g:'C', inf:'Creer',      tr:'croire',                    ans:['croire'] },
  { g:'C', inf:'Deber',      tr:'devoir',                    ans:['devoir'] },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LIST DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const S  = inf => VERBS.find(v => v.inf === inf);
const by = (...names) => VERBS.filter(v => names.includes(v.inf));

const IRRE   = ['Ser','Estar','Ir','Tener','Hacer','Venir','Poder','Querer','Decir','Saber','Dar','Ver'];
const GO_V   = ['Tener','Hacer','Salir','Poner','Venir','Decir','Traer'];
const DIPH   = ['Querer','Poder','Volver','Dormir','Cerrar','Empezar','Entender','Preferir','Sentarse','Encontrar'];
const REFLEX = ['Levantarse','Sentarse','Ponerse'];
const BAR    = ['Pedir','Pagar','Beber','Traer','Querer','Gustar','Dar','Salir','Volver','Llegar','Esperar'];
const VOYAGE = ['Llegar','Salir','Volver','Ir','Venir','Llevar','Buscar','Encontrar','Perder','Esperar','Traer'];
const TRAV   = ['Trabajar','Empezar','Terminar','Necesitar','Buscar','Encontrar','Saber','Poder','Deber','Escribir','Leer','Entender','Aprender'];
const MAIS   = ['Levantarse','Sentarse','Dormir','Comer','Beber','Poner','Abrir','Cerrar','Comprar','Vivir'];
const COMM   = ['Hablar','Decir','Escuchar','Escribir','Leer','Saber','Conocer','Entender','Creer','Ver'];
const ARGENT = ['Ganar','Gastar','Ahorrar','Pagar','Comprar','Necesitar','Deber','Tener'];
const REG_AR = ['Hablar','Comprar','Pagar','Llegar','Escuchar','Mirar','Buscar','Ganar','Gastar','Ahorrar','Necesitar','Ayudar','Trabajar','Estudiar','EnseÃ±ar','Terminar','Esperar','Llevar'];
const REG_EI = ['Comer','Beber','Leer','Creer','Vivir','Escribir','Abrir','Aprender'];
const STARTER= ['Ser','Estar','Tener','Hacer','Ir','Poder','Querer','Decir','Hablar','Gustar'];

const TABS = {
  niveau: [
    { id:'starter',    emoji:'ğŸŒ±', label:'Starter',     desc:'10 verbes â€” pour commencer',      f: v => STARTER.includes(v.inf) },
    { id:'essentiels', emoji:'â­', label:'Essentiels',  desc:'26 verbes â€” base solide',         f: v => v.g === 'E' },
    { id:'courants',   emoji:'ğŸ“š', label:'Courants',    desc:'30 verbes â€” niveau intermÃ©diaire', f: v => v.g === 'C' },
    { id:'tout',       emoji:'ğŸ”¥', label:'Tout',        desc:'56 verbes â€” challenge total',      f: ()=> true },
  ],
  theme: [
    { id:'bar',    emoji:'ğŸº', label:'Bar & tapas',     desc:'Commander, payer, trinquer',        f: v => BAR.includes(v.inf) },
    { id:'voyage', emoji:'âœˆï¸', label:'Voyage',          desc:'Transports, se repÃ©rer',            f: v => VOYAGE.includes(v.inf) },
    { id:'trav',   emoji:'ğŸ’¼', label:'Travail',         desc:'RÃ©unions, mails, planning',         f: v => TRAV.includes(v.inf) },
    { id:'mais',   emoji:'ğŸ ', label:'Maison & routine',desc:'Quotidien domestique',              f: v => MAIS.includes(v.inf) },
    { id:'comm',   emoji:'ğŸ—£ï¸', label:'Communication',  desc:'Conversations du quotidien',        f: v => COMM.includes(v.inf) },
    { id:'argent', emoji:'ğŸ’°', label:'Argent',          desc:'Gagner, dÃ©penser, Ã©conomiser',      f: v => ARGENT.includes(v.inf) },
  ],
  grammaire: [
    { id:'irre',   emoji:'ğŸ”´', label:'Grands irrÃ©guliers', desc:'Les 12 verbes les plus tordus',       f: v => IRRE.includes(v.inf) },
    { id:'go',     emoji:'âš¡', label:'Verbes en -go',      desc:'yo â†’ tengo, hago, salgoâ€¦',            f: v => GO_V.includes(v.inf) },
    { id:'diph',   emoji:'ğŸ”€', label:'Diphtongues',        desc:'puedo, quiero, vuelvo, duermoâ€¦',      f: v => DIPH.includes(v.inf) },
    { id:'reflex', emoji:'ğŸ”„', label:'RÃ©flÃ©chis',          desc:'me levanto, te sientas, se poneâ€¦',    f: v => REFLEX.includes(v.inf) },
    { id:'regar',  emoji:'âœ…', label:'RÃ©guliers -ar',      desc:'Pattern hablar, trabajar, llegarâ€¦',   f: v => REG_AR.includes(v.inf) },
    { id:'regei',  emoji:'âœ…', label:'RÃ©guliers -er/-ir',  desc:'Pattern comer, vivir, escribirâ€¦',     f: v => REG_EI.includes(v.inf) },
  ],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentList = null;
let deck = [];
let idx  = 0;
let hintUsed = false;
let wrongTimer = null;
let currentTab = 'niveau';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const norm = s => s.normalize('NFD').replace(/[\u0300-\u036f]/g,'')
                   .toLowerCase().trim().replace(/['']/g,"'");

function check(input, ans) {
  const a = norm(input);
  return a.length >= 2 && ans.some(c => norm(c) === a);
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

const getBest = id => parseInt(localStorage.getItem('vg-b-'+id)||'0');
const setBest = (id,n) => { if(n > getBest(id)) localStorage.setItem('vg-b-'+id, n); };
const getRuns = id => parseInt(localStorage.getItem('vg-r-'+id)||'0');
const addRun  = id => localStorage.setItem('vg-r-'+id, getRuns(id)+1);

function listVerbs(listDef) { return VERBS.filter(listDef.f); }
function allLists() { return [...TABS.niveau, ...TABS.theme, ...TABS.grammaire]; }
function findList(id) { return allLists().find(l => l.id === id); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREEN MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('s-'+id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function switchTab(tab, btn) {
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderHome();
}

function renderHome() {
  const sec = document.getElementById('list-section');
  sec.innerHTML = TABS[currentTab].map(l => {
    const verbs = listVerbs(l);
    const n     = verbs.length;
    const best  = getBest(l.id);
    const runs  = getRuns(l.id);
    const nextRun = runs + 1;
    const runStr  = runs > 0 ? ` Â· Run #${nextRun} Ã  venir` : '';
    let scoreStr;
    if (best === 0)  scoreStr = '<span style="color:rgba(255,255,255,.25)">Jamais jouÃ©</span>';
    else if (best === n) scoreStr = `<span class="done-badge">âœ“ ComplÃ©tÃ© ! (${n}/${n})</span>`;
    else scoreStr = `Meilleur : <b>${best}/${n}</b>`;

    return `
    <div class="list-card" onclick="startGame('${l.id}')">
      <div class="lc-emoji">${l.emoji}</div>
      <div class="lc-body">
        <div class="lc-name">${l.label}</div>
        <div class="lc-desc">${n} verbes${runStr}</div>
        <div class="lc-score">${scoreStr}</div>
      </div>
      <div class="lc-arrow">â€º</div>
    </div>`;
  }).join('');
}

function goHome() {
  if (wrongTimer) { clearInterval(wrongTimer); wrongTimer = null; }
  renderHome();
  show('home');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startGame(id) {
  currentList = findList(id);
  if (!currentList) return;
  deck = shuffle(listVerbs(currentList));
  idx  = 0; hintUsed = false;
  addRun(id);
  document.getElementById('run-tag').textContent  = 'Run #' + getRuns(id);
  document.getElementById('list-tag').textContent = currentList.emoji + ' ' + currentList.label;
  renderVerb(false);
  show('game');
  setTimeout(() => document.getElementById('answer-input').focus(), 280);
}

function renderVerb(animate) {
  const verb  = deck[idx];
  const input = document.getElementById('answer-input');
  const msg   = document.getElementById('msg');
  input.value = ''; input.className = '';
  msg.textContent = ''; msg.className = 'msg';
  document.getElementById('hint-val').textContent = '';
  document.getElementById('hint-btn').style.display = '';
  hintUsed = false;

  // progress
  const pct = deck.length ? (idx / deck.length) * 100 : 0;
  document.getElementById('prog-fill').style.width = pct + '%';
  document.getElementById('g-counter').textContent = 'ğŸ”¥ ' + idx + '/' + deck.length;

  document.getElementById('big-verb').textContent = verb ? verb.inf : 'â€”';

  if (animate) {
    const card = document.getElementById('game-card');
    card.style.transition = 'none';
    card.style.transform  = 'translateY(48px)';
    card.style.opacity    = '0';
    requestAnimationFrame(() => requestAnimationFrame(() => {
      card.style.transition = 'transform .35s ease, opacity .35s ease';
      card.style.transform  = 'translateY(0)';
      card.style.opacity    = '1';
    }));
  }
  setTimeout(() => document.getElementById('answer-input').focus(), 50);
}

function validate() {
  const input = document.getElementById('answer-input');
  const verb  = deck[idx];
  if (!verb || !input.value.trim()) return;

  if (check(input.value, verb.ans)) {
    onCorrect();
  } else {
    onWrong(verb);
  }
}

function onCorrect() {
  const input = document.getElementById('answer-input');
  const msg   = document.getElementById('msg');
  const card  = document.getElementById('game-card');

  input.className = 'ok';
  msg.textContent = 'âœ“ Bravo !'; msg.className = 'msg ok-msg';

  // exit animation
  card.style.transition = 'transform .28s ease, opacity .28s ease';
  card.style.transform  = 'translateY(-48px)';
  card.style.opacity    = '0';

  idx++;
  setBest(currentList.id, idx);

  if (idx >= deck.length) {
    setTimeout(() => showWin(), 300);
  } else {
    setTimeout(() => renderVerb(true), 300);
  }
}

function onWrong(verb) {
  const input = document.getElementById('answer-input');
  const card  = document.getElementById('game-card');
  const flash = document.getElementById('flash');

  input.className = 'ko';

  // shake + flash
  card.classList.remove('shaking');
  void card.offsetWidth;
  card.classList.add('shaking');
  flash.classList.add('on');
  setTimeout(() => flash.classList.remove('on'), 320);

  // show wrong screen after brief pause
  setTimeout(() => {
    document.getElementById('wr-verb').textContent   = verb.inf + ' â†’ ???';
    document.getElementById('wr-answer').textContent = verb.ans[0];

    let cd = 3;
    document.getElementById('wr-cd').textContent = cd;
    show('wrong');

    wrongTimer = setInterval(() => {
      cd--;
      document.getElementById('wr-cd').textContent = cd;
      if (cd <= 0) clearIntervalAndRestart();
    }, 1000);
  }, 550);
}

function clearIntervalAndRestart() {
  if (wrongTimer) { clearInterval(wrongTimer); wrongTimer = null; }
  restartGame();
}

function restartGame() {
  deck = shuffle(listVerbs(currentList));
  idx  = 0; hintUsed = false;
  addRun(currentList.id);
  document.getElementById('run-tag').textContent = 'Run #' + getRuns(currentList.id);

  // reset card styles
  const card = document.getElementById('game-card');
  card.style.transition = ''; card.style.transform = ''; card.style.opacity = '';

  renderVerb(false);
  show('game');
  setTimeout(() => document.getElementById('answer-input').focus(), 280);
}

function showHint() {
  if (hintUsed) return;
  hintUsed = true;
  const verb = deck[idx];
  const a    = verb.ans[0];
  document.getElementById('hint-val').textContent =
    a.charAt(0).toUpperCase() + 'â€¦ (' + a.length + ' lettres)';
  document.getElementById('hint-btn').style.display = 'none';
}

function showWin() {
  const n    = deck.length;
  const best = getBest(currentList.id);
  const isRecord = n >= best; // always true when completing full deck

  document.getElementById('win-sub').textContent =
    `Tu as fait les ${n} verbes sans faute ! ğŸ‰`;
  document.getElementById('win-badge').textContent =
    isRecord ? 'ğŸ† Nouveau record !' : `ğŸ† Record : ${best}/${n}`;

  show('win');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderHome();
</script>
</body>
</html>
